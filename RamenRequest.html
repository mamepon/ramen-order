
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>ãƒ©ãƒ¼ãƒ¡ãƒ³æ³¨æ–‡</title>
  <style>
  body { font-family: sans-serif; margin: 0; padding: 0; }
  .container { display: flex; flex-wrap: wrap; justify-content: center; margin: 10px; }
  .item { margin: 10px; }
  .item button { width: 140px; height: 100px; font-size: 16px; }
  .item button.selected { border: 2px solid red; } /* â† ã“ã‚Œè¿½åŠ ï¼ */
  .edit-button { margin-left: 10px; color: blue; cursor: pointer; }
  .delete-button { margin-left: 10px; color: red; cursor: pointer; }
  @media (max-width: 600px) {
    .item button { width: 100px; height: 80px; font-size: 12px; }
  }
</style>

</head>
<body>
<div id="selection-status" style="
  position: fixed;
  top: 0;
  right: 0;
  background: #fff;
  border-left: 1px solid #ccc;
  border-bottom: 1px solid #ccc;
  padding: 10px;
  font-size: 14px;
  z-index: 999;
  max-width: 240px;
  display: none;
">
  <h4>ğŸ“ é¸æŠä¸­</h4>
  <div id="status-ramen"></div>
  <div id="status-noodle"></div>
  <div id="status-toppings"></div>
  <div id="status-dons"></div>
</div>

<button id="back-button" onclick="resetSelection()" style="display:none;">æœ€åˆã«æˆ»ã‚‹</button>
<h2 id="initial-title">ã‚»ãƒƒãƒˆã¾ãŸã¯ãƒ©ãƒ¼ãƒ¡ãƒ³ã‚’é¸ã‚“ã§ãã ã•ã„</h2>
<h2 id="ramen-title" style="display:none;">ãƒ©ãƒ¼ãƒ¡ãƒ³ã‚’é¸æŠã—ã¦ãã ã•ã„</h2>
<h2 id="set-title" style="display:none;">ã‚»ãƒƒãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„</h2>
<div id="category-menu" class="container"></div>
<div id="ramen-menu" class="container" style="display:none;"></div>

<div id="topping-section" style="display:none;">
  <h2>éººã®é‡ã‚’é¸æŠã—ã¦ãã ã•ã„</h4>
  <div id="noodle-menu" class="container"></div>

  <h2>ãƒˆãƒƒãƒ”ãƒ³ã‚°ã‚’é¸ã‚“ã§ãã ã•ã„ï¼ˆè¤‡æ•°å¯ï¼‰</h4>
  <div id="topping-menu" class="container"></div>

  <h2>ä¸¼ã‚‚ã„ã‹ãŒã§ã—ã‚‡ã†ã‹ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰</h4>
  <div id="don-menu" class="container" style="display:none;"></div>

  <p id="total-price">åˆè¨ˆé‡‘é¡: 0å††</p>
  <button onclick="addToCart()" id="confirm-button">ã‚«ãƒ¼ãƒˆã«è¿½åŠ </button>
</div>

<div id="cart">
  <h2>ğŸ›’ ã‚«ãƒ¼ãƒˆ</h2>
  <ul id="cart-list"></ul>
  <p id="cart-total">ã‚«ãƒ¼ãƒˆåˆè¨ˆé‡‘é¡: 0å††</p>
</div>

<div id="payment" style="margin-top:30px;">
  <h2>ğŸ’´ ä¼šè¨ˆ</h2>
  <button onclick="showPayment()">ä¼šè¨ˆã«é€²ã‚€</button>
  <div id="payment-section" style="display:none;">
    <label>é ã‹ã‚Šé‡‘é¡: <input type="number" id="paid-amount" /> å††</label>
    <button onclick="calculateChange()">ãŠé‡£ã‚Šã‚’è¨ˆç®—</button>
    <p id="change-result"></p>
  </div>
</div>

<script>
const ramenList = [
  { name: "ç‰¹è£½ãƒ©ãƒ¼ãƒ¡ãƒ³", price: 1100 },
  { name: "ãƒãƒ£ãƒ¼ã‚·ãƒ¥ãƒ¼ãƒ¡ãƒ³", price: 1000 },
  { name: "ã­ããƒ©ãƒ¼ãƒ¡ãƒ³", price: 950 },
  { name: "å‘³ç‰ãƒ©ãƒ¼ãƒ¡ãƒ³", price: 900 },
  { name: "ã®ã‚Šãƒ©ãƒ¼ãƒ¡ãƒ³", price: 900 },
  { name: "ãƒ©ãƒ¼ãƒ¡ãƒ³", price: 800 },
  { name: "ãƒ¬ãƒ‡ã‚£ãƒ¼ã‚¹ãƒ©ãƒ¼ãƒ¡ãƒ³", price: 700 }
];

const setList = [
  { name: "æº€è…¹ã‚»ãƒƒãƒˆã€ä¸­ç››ã‚Š+ãƒ©ã‚¤ã‚¹ã€‘", price: 1100 },
  { name: "æº€è…¹ã‚»ãƒƒãƒˆã€å¤§ç››ã‚Šã€‘", price: 1100 },
  { name: "æ˜¼é£¯ã‚»ãƒƒãƒˆã€ä¸¦ç››ã‚Š+åŠãƒ©ã‚¤ã‚¹ã€‘", price: 1000 },
  { name: "æ˜¼é£¯ã‚»ãƒƒãƒˆã€ä¸­ç››ã‚Šã€‘", price: 1000 },
  { name: "æœé£¯ã‚»ãƒƒãƒˆã€åŠãƒ©ãƒ¼ãƒ¡ãƒ³+è‚‰ã®ã›ã”é£¯ã€‘", price: 750 }
];

const donList = [
  { name: "ãƒãƒ£ãƒ¼ã‚·ãƒ¥ãƒ¼ä¸¼", price: 300 },
  { name: "é«˜èœä¸¼", price: 300 },
  { name: "æ˜å¤ªå­ä¸¼", price: 300 }
];

const toppingList = [
  { name: "é‡èœMIX", price: 100 },
  { name: "ã‚­ãƒ£ãƒ™ãƒ„", price: 100 },
  { name: "ã“ã†ã‚‚ã‚„ã—", price: 50 },
  { name: "ã­ã", price: 150 },
  { name: "ã­ãMIX", price: 100 },
  { name: "ä¹æ¡ã­ã", price: 100 },
  { name: "é’ã­ã", price: 50 },
  { name: "è–¬å‘³å¢—ã—", price: 50 },
  { name: "ç”Ÿãƒ‹ãƒ©", price: 50 },
  { name: "ã‚³ãƒ¼ãƒ³", price: 50 },
  { name: "ãƒ¬ã‚¿ã‚¹", price: 100 },
  { name: "ãŸã¾ã­ã", price: 50 },
  { name: "ç´«ç‰ã­ã", price: 50 },
  { name: "æµ·è‹”å¢—ã—", price: 100 },
  { name: "ãƒãƒ£ãƒ¼ã‚·ãƒ¥ãƒ¼", price: 200 },
  { name: "å‘³ç‰", price: 100 }
];

const noodleList = [
  { name: "æ™®é€š", price: 0 },
  { name: "ä¸­ç››ã‚Š", price: 100 },
  { name: "å¤§ç››ã‚Š", price: 200 }
];

const categoryList = [
  { name: "ãƒ©ãƒ¼ãƒ¡ãƒ³å˜å“", type: "ramen" },
  { name: "ã‚»ãƒƒãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼", type: "set" }
];

let selectedRamen = null;
let selectedToppings = [];
let selectedDon = [];
let selectedNoodle = noodleList.find(n => n.name === "æ™®é€š") || noodleList[0];
let cartTotal = 0;
let editingIndex = null;

function renderMenu(list, containerId) {
  const container = document.getElementById(containerId);
  container.innerHTML = "";

  list.forEach(item => {
    const div = document.createElement("div");
    div.className = "item";
    const button = document.createElement("button");
    if (containerId === "category-menu") {
      button.innerHTML = `${item.name}`;
    } 
    else {
      button.innerHTML = `${item.name}<br>${item.price}å††`;
    }

    // â˜… é¸æŠçŠ¶æ…‹ã«å¿œã˜ã¦ .selected ã‚’ button ã«ä»˜ä¸
    let isSelected = false;
    if (containerId === "noodle-menu" && selectedNoodle?.name === item.name) {
      isSelected = true;
    }
    if (containerId === "topping-menu" && selectedToppings.some(t => t.name === item.name)) {
      isSelected = true;
    }
    if (containerId === "don-menu" && selectedDon.some(d => d.name === item.name)) {
      isSelected = true;
    }
    if (containerId === "ramen-menu" && selectedRamen?.name === item.name) {
      isSelected = true;
    }
    if (isSelected) button.classList.add("selected");

    button.onclick = () => {
      if (containerId === "category-menu") {
        selectCategory(item);
      } else if (containerId === "ramen-menu") {
        document.querySelectorAll("#ramen-menu .item button").forEach(el => el.classList.remove("selected"));
        button.classList.add("selected");
        selectedRamen = item;
        //selectedToppings = [];
        //selectedDon = [];
        selectedNoodle = noodleList[0];
        document.getElementById("topping-section").style.display = "block";
        document.getElementById("confirm-button").textContent = editingIndex !== null ? "ä¿®æ­£ã‚’ç¢ºå®š" : "ã‚«ãƒ¼ãƒˆã«è¿½åŠ ";
        document.getElementById("selection-status").style.display = "block";
        updateSelectionStatus();

        renderMenu(noodleList, "noodle-menu");
        renderMenu(toppingList, "topping-menu");
        updateTotalPrice();
        updateSelectionStatus();
      } else if (containerId === "topping-menu") {
        toggleTopping(div, item);
      } else if (containerId === "noodle-menu") {
        selectNoodle(div, item);
      } else if (containerId === "don-menu") {
        toggleDon(div, item);
      }
    };

    div.appendChild(button);
    container.appendChild(div);
  });
}


function selectCategory(item) {
  // ã‚¿ã‚¤ãƒˆãƒ«åˆ‡ã‚Šæ›¿ãˆ
  document.getElementById("initial-title").style.display = "none";
  document.getElementById("ramen-title").style.display = item.type === "ramen" ? "block" : "none";
  document.getElementById("set-title").style.display = item.type === "set" ? "block" : "none";

  // ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
  document.getElementById("category-menu").style.display = "none";
  document.getElementById("ramen-menu").style.display = "flex";
  document.getElementById("topping-section").style.display = "none";
  document.getElementById("don-menu").style.display = "none";
  if (item.type === "ramen") {
    renderMenu(ramenList, "ramen-menu");
  } else if (item.type === "set") {
    renderMenu(setList, "ramen-menu");
  }
  document.getElementById("back-button").style.display = "inline-block";

}


function toggleTopping(el, item) {
  const idx = selectedToppings.findIndex(t => t.name === item.name);
  const button = el.querySelector("button"); // â† div ã®ä¸­ã® button ã‚’å–å¾—

  if (idx >= 0) {
    selectedToppings.splice(idx, 1);
    button.classList.remove("selected");
  } else {
    selectedToppings.push(item);
    button.classList.add("selected");
  }

  updateTotalPrice();
  updateSelectionStatus(); 
}


function toggleDon(el, item) {
  const idx = selectedDon.findIndex(d => d.name === item.name);
  if (idx >= 0) {
    selectedDon.splice(idx, 1);
  } else {
    selectedDon.push(item);
  }

  // å…¨ã¦ã®ä¸¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã® .selected ã‚’ãƒªã‚»ãƒƒãƒˆ
  document.querySelectorAll("#don-menu .item").forEach(d => {
    const btnText = d.textContent.split(/\s+/)[0]; // æœ€åˆã®æ–‡å­—åˆ—ã ã‘æ¯”è¼ƒ
    if (selectedDon.some(sd => sd.name === btnText)) {
      d.classList.add("selected");
    } else {
      d.classList.remove("selected");
    }
  });

  updateTotalPrice();
  updateSelectionStatus(); 
}



function selectNoodle(el, item) {
  selectedNoodle = item;
  document.querySelectorAll("#noodle-menu .item button").forEach(btn => btn.classList.remove("selected"));
  const button = el.querySelector("button");
  button.classList.add("selected");
  updateTotalPrice();
  updateSelectionStatus(); 
}

function addToCart() {
  if (!selectedRamen) {
    alert("ãƒ©ãƒ¼ãƒ¡ãƒ³ã¾ãŸã¯ã‚»ãƒƒãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");
    return;
  }
  const noodle = selectedNoodle.name;
  const toppings = selectedToppings.map(t => t.name).join(", ") || "ãªã—";
  const dons = selectedDon.map(d => d.name).join(", ") || "ãªã—";
  const total = selectedRamen.price + selectedNoodle.price +
    selectedToppings.reduce((sum, t) => sum + t.price, 0) +
    selectedDon.reduce((sum, d) => sum + d.price, 0);

  const li = document.createElement("li");
  li.textContent = `${selectedRamen.name}ï¼ˆ${noodle}, ãƒˆãƒƒãƒ”ãƒ³ã‚°ï¼š${toppings}, ä¸¼ï¼š${dons}ï¼‰ - ${total}å††`;
  li.dataset.price = total;

  const editBtn = document.createElement("span");
editBtn.className = "edit-button";
editBtn.textContent = "ä¿®æ­£";
editBtn.onclick = (e) => {
  e.stopPropagation();
  editCartItem(li);
};
li.appendChild(editBtn);


  const deleteBtn = document.createElement("span");
  deleteBtn.className = "delete-button";
  deleteBtn.textContent = "å‰Šé™¤";
  deleteBtn.onclick = () => {
    cartTotal -= parseInt(li.dataset.price || "0");
    li.remove();
    document.getElementById("cart-total").innerText = `ã‚«ãƒ¼ãƒˆåˆè¨ˆé‡‘é¡: ${cartTotal}å††`;
  };
  li.appendChild(deleteBtn);

  const list = document.getElementById("cart-list");
  if (editingIndex !== null) {
    const oldItem = list.children[editingIndex];
    cartTotal -= parseInt(oldItem.dataset.price || "0");
    list.replaceChild(li, oldItem);
    editingIndex = null;
  } else {
    list.appendChild(li);
  }

  cartTotal += total;
  document.getElementById("cart-total").innerText = `ã‚«ãƒ¼ãƒˆåˆè¨ˆé‡‘é¡: ${cartTotal}å††`;
  resetSelection();
}

function resetSelection() {
  selectedRamen = null;
  selectedToppings = [];
  selectedDon = [];
  selectedNoodle = noodleList.find(n => n.name === "æ™®é€š") || noodleList[0];
  editingIndex = null;

  document.getElementById("initial-title").style.display = "block";
  document.getElementById("ramen-title").style.display = "none";
  document.getElementById("set-title").style.display = "none";
  document.getElementById("back-button").style.display = "none";

  document.getElementById("category-menu").style.display = "flex";
  document.getElementById("ramen-menu").style.display = "none";
  document.getElementById("don-menu").style.display = "none";
  document.getElementById("topping-section").style.display = "none";

  renderMenu(categoryList, "category-menu");
  document.getElementById("selection-status").innerHTML = "";
  document.getElementById("selection-status").style.display = "none";

}




function showPayment() {
  document.getElementById("payment-section").style.display = "block";
}

function calculateChange() {
  const paid = parseInt(document.getElementById("paid-amount").value);
  const change = paid - cartTotal;
  const result = document.getElementById("change-result");
  if (isNaN(paid)) {
    result.innerText = "é‡‘é¡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚";
  } else if (change < 0) {
    result.innerText = `ä¸è¶³ã—ã¦ã„ã¾ã™ï¼ˆã‚ã¨ ${-change}å††å¿…è¦ã§ã™ï¼‰ã€‚`;
  } else {
    result.innerText = `ãŠé‡£ã‚Š: ${change}å††`;
  }
}
function updateTotalPrice() {
  let total = selectedRamen?.price || 0;
  total += selectedNoodle?.price || 0;
  total += selectedToppings.reduce((sum, t) => sum + t.price, 0);
  total += selectedDon.reduce((sum, d) => sum + d.price, 0);
  document.getElementById("total-price").innerText = `åˆè¨ˆé‡‘é¡: ${total}å††`;

  // ãƒ©ãƒ¼ãƒ¡ãƒ³å˜å“ã®å ´åˆã«ä¸¼ã‚’è¡¨ç¤º
  if (selectedRamen && !setList.some(set => set.name === selectedRamen.name)) {
    document.getElementById("don-menu").style.display = "flex";
    renderMenu(donList, "don-menu");
  } else {
    document.getElementById("don-menu").style.display = "none";
    document.getElementById("don-menu").style.display = "none";
  }
}
function editCartItem(li) {
  console.log("editCartItem called:", li.textContent);

  const fullText = li.textContent.replace(/\s*(ä¿®æ­£|å‰Šé™¤).*$/, "").trim();
  const nameOnly = fullText.split("ï¼ˆ")[0]; // æœ€åˆã®å…¨è§’ã‚«ãƒƒã‚³ã¾ã§ã‚’å•†å“åã¨ã™ã‚‹

  const isSet = setList.some(set => set.name === nameOnly);
  selectedRamen = isSet
    ? setList.find(r => r.name === nameOnly)
    : ramenList.find(r => r.name === nameOnly);

  if (!selectedRamen) {
    alert("è©²å½“ã®å•†å“ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: " + nameOnly);
    return;
  }

  selectedToppings = toppingList.filter(t => fullText.includes(t.name));
  selectedDon = donList.filter(d => fullText.includes(d.name));
  selectedNoodle = noodleList.find(n => fullText.includes(n.name)) || noodleList[0];

  editingIndex = [...document.getElementById("cart-list").children].indexOf(li);

  document.getElementById("initial-title").style.display = "none";
  document.getElementById("ramen-title").style.display = isSet ? "none" : "block";
  document.getElementById("set-title").style.display = isSet ? "block" : "none";
  document.getElementById("category-menu").style.display = "none";
  document.getElementById("ramen-menu").style.display = "flex";
  document.getElementById("topping-section").style.display = "block";
  document.getElementById("don-menu").style.display = isSet ? "none" : "flex";
  document.getElementById("confirm-button").textContent = "ä¿®æ­£ã‚’ç¢ºå®š";
  
  renderMenu(isSet ? setList : ramenList, "ramen-menu");
  renderMenu(noodleList, "noodle-menu");
  renderMenu(toppingList, "topping-menu");
  if (!isSet) renderMenu(donList, "don-menu");

  document.getElementById("back-button").style.display = "inline-block";
  updateTotalPrice();
  updateSelectionStatus(); 
  document.getElementById("selection-status").style.display = "block";
  updateSelectionStatus();

}

function updateSelectionStatus() {
  const status = document.getElementById("selection-status");
  if (!status) return;

  const ramen = selectedRamen ? selectedRamen.name : "æœªé¸æŠ";
  const noodle = selectedNoodle ? selectedNoodle.name : "æœªé¸æŠ";
  const toppings = selectedToppings.map(t => t.name).join("ã€") || "ãªã—";
  const dons = selectedDon.map(d => d.name).join("ã€") || "ãªã—";

  let total = selectedRamen?.price || 0;
  total += selectedNoodle?.price || 0;
  total += selectedToppings.reduce((sum, t) => sum + t.price, 0);
  total += selectedDon.reduce((sum, d) => sum + d.price, 0);

  status.innerHTML = `
    <strong>ã€é¸æŠä¸­ã€‘</strong><br>
    ğŸœ ${ramen}<br>
    ğŸ¥ éººé‡ï¼š${noodle}<br>
    ğŸ§„ ãƒˆãƒƒãƒ”ãƒ³ã‚°ï¼š${toppings}<br>
    ğŸš ä¸¼ï¼š${dons}<br>
    ğŸ’° å°è¨ˆï¼š<strong>${total}å††</strong>
  `;
}


window.onload = () => {
  document.getElementById("category-menu").style.display = "flex";
  renderMenu(categoryList, "category-menu");
};

</script>

</body>
</html>
